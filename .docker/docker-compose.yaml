version: "3.8"
services:
  build_sdb:
    # pull_policy:
    #   "always"
    environment:
      - PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/build/solana/sdk/docker-solana/usr/bin
    ulimits:
      nofile:
        soft: 1000000
        hard: 1000000
    image: kindtek/sdb_dev
    build:
      context: ./
      target: installed-sdb_dev
    init: true
    stop_signal: SIGKILL
    command:
      - "apk update"
    entrypoint:
      - "sh /build/yubico-sdk-net/Yubico.NativeShims/build-ubuntu.sh  && sh /build/solana/sdk/docker-solana/build.sh"
    volumes:
      - ./build:/build
      # - ./build/solana/sdk/docker-solana/usr/bin:/usr/share/sol/bin
      # - ./build/yubico-net-sdk/Yubico.NativeShims/ubuntu-x64:/var/run/docker.sock
    labels:
      com.docker.devenvironments: "true"
      com.docker.devenvironments.compose: "true"
      com.docker.devenvironments.container: "true"
      com.docker.devenvironments.name: sdb_dev
networks:
  default:
    name: networks-sdb_dev
    attachable: true
  # portainer_agent:
  #   driver: overlay
  #   attachable: true

volumes:
  volume-yub-bin:
    name: volume-yub-bin
  volume-sol-bin:
    name: volume-sol-bin
